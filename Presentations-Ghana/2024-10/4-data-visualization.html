<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Session 4 - Data visualization</title>
    <meta charset="utf-8" />
    <meta name="author" content="María Reyes Retana" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/xaringanExtra-webcam/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="libs/remark-css/default.css" type="text/css" />
    <link rel="stylesheet" href="libs/remark-css/metropolis.css" type="text/css" />
    <link rel="stylesheet" href="libs/remark-css/metropolis-fonts.css" type="text/css" />
    <link rel="stylesheet" href="libs/remark-css/custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Session 4 - Data visualization
]
.subtitle[
## R training
]
.author[
### María Reyes Retana
]
.date[
### The World Bank | January 2025
]

---




&lt;style type="text/css"&gt;
@media print {
  .has-continuation {
    display: block !important;
  }
}
&lt;/style&gt;

&lt;img src="img/template.png" width="100%" style="display: block; margin: auto;" /&gt;

# Table of contents 

- [Introduction](#intro)
- [The grammar of graphics](#grammar-of-graphics)
- [Bar plots](#bar-plots)
- [Pie charts](#pie-charts)
- [Line plots](#line-plots)
- [Wrapping up](#wrapping-up)

---

class: inverse, center, middle
name: intro

# Introduction  

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Introduction  

## About this session

&lt;img src="img/session4/data-work-data-vis.png" width="80%" style="display: block; margin: auto;" /&gt;

---

# Introduction  

## Data visualization in the data work pipeline

- Compared to other kind of outputs, data visualization involves an extra step after data wrangling: producing the visualization itself

- We also us R code to produce data visualizations

- The input for that code is a wrangled dataframe, dataframe that is ready to be used

&lt;img src="img/session4/data-vis.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Introduction

## From Your Annual Reports  

In your annual reports, the most common visualizations include:  

1. **Bar Graphs**: Used to compare categories (e.g., spending across departments or revenue by month).  
2. **Pie Charts**: Used to show proportions (e.g., product share, budget breakdown).  

.pull-left[
**Bar Graph Example**  
![Bar Graph](img/session4/bar-chart.png)
]

.pull-right[
**Pie Chart Example**  
![Pie Chart](img/session4/pie-chart.png)
]

---

# Introduction

## What You Will Learn  

Today, I will teach you how to:  

1. **Recreate these common visualizations** (and more) using code.  
2. Build clean and reproducible charts that you can easily include in your annual reports.  
3. Explore additional visualization techniques to make your data more impactful.  

We will keep using the data we have been using from the beginning to keep this simple, but the code could be recycled to fit the data of your annual reports. 

Let’s get started!  

---

# Introduction  

## Data visualization in R

.pull-left[
- We'll use the package `ggplot2` to create data visualizations

- `ggplot2` greatly facilitates producing plots in R

  + It follows a syntax based on a description of the plot you want to obtain
  
  + This syntax is called **grammar of graphics**, a benchmark method of data visualization definition in statistical programming
]

.pull-right[
&lt;img src="img/session4/ggplot2.png" width="70%" style="display: block; margin: auto;" /&gt;
]

---

# ggplot2

&lt;img src="img/session4/ggplot2-dib.png" width="70%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
name: grammar-of-graphics

# The grammar of graphics 

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# The grammar of graphics

## What is ggplot2?  

- **ggplot2** is a powerful and flexible tool for creating data visualizations in R.  
- It combines **philosophy + functions** into a well-organized framework.  

### Things to Keep in Mind:  
1. ggplot2 may feel like **a lot to learn**, but let's do it step by step. 
2. Today, we’ll cover the basics, but you’ll also get resources to keep exploring on your own.  

---

# The grammar of graphics

## The Structure of ggplot2  

Creating a plot with ggplot2 requires **three basic components**:  

1. **Data**: The dataset you want to visualize.  
2. **Aesthetics (aes)**: How you map your data to visual elements (e.g., x-axis, y-axis, color).  
3. **Geometry (geom)**: The type of plot you want (e.g., bar graph, scatter plot).  

(and many more but we will keep it simple in this presentation)

---

# The grammar of graphics  

## The grammar of graphics in `ggplot2`

I will use the table of employees by department we created in session two to start with this.

You can also download it from here: https://osf.io/qb92t if you don't have it. 


``` r
employees_by_department &lt;- read.csv("data/employees_by_department.csv")
```


&lt;img src="img/session4/grammar-of-graphics.png" width="50%" style="display: block; margin: auto;" /&gt;

---

# The grammar of graphics  

## The grammar of graphics in `ggplot2`

&lt;img src="img/session4/grammar-of-graphics2.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# The grammar of graphics  

## The grammar of graphics in `ggplot2`

&lt;img src="img/session4/grammar-of-graphics3x.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# The grammar of graphics 

## The grammar of graphics in `ggplot2`

&lt;img src="img/session4/grammar-of-graphics3y.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# The grammar of graphics  

## The grammar of graphics in `ggplot2`

&lt;img src="img/session4/grammar-of-graphics4gc.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# The grammar of graphics 

## The grammar of graphics in `ggplot2`

&lt;img src="img/session4/grammar-of-graphics4l.png" width="70%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
name: bar-plots

# Bar plots  

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Bar plots  

## Exercise 1a: Create a basic bar plot

1. Open a new script for this session by clicking on `File` &gt;&gt; `New File` &gt;&gt; `R Script`

1. Load `ggplot2`


``` r
library(ggplot2)
```

1. Produce a basic bar plot with the following code:


``` r
ggplot(employees_by_department) +
  aes(x = department,
      y = number) +
  geom_col() +
  labs(title = "Number of employees by department, 2024")
```

---

# Bar plots  



This result should be displayed in the lower right panel of your RStudio window

&lt;img src="4-data-visualization_files/figure-html/unnamed-chunk-17-1.png" width="60%" style="display: block; margin: auto;" /&gt;

In Excel ❎ you would select the data and insert bar graph. 

---

# Bar plots  

This plot doesn't look great yet!

.pull-left[
- `department` is too crowded as the names are long, but R does not know this. We need to tell R that those labels should be rotated

- We can center the title

- We should add axis labels (instead of just variable names)

- We can add color
]

.pull-right[
&lt;img src="4-data-visualization_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

# Bar plots  

## Exercise 1b: Improve your bar plot

1. Use the following code to improve the aesthetics of your plot


``` r
ggplot(employees_by_department) +
  aes(x = department,
      y = number) +
* geom_col(fill = "#9370DB") +
  labs(
    title = "Number of employees by department, 2024", # title
*   x = "Department",
*   y = "Number"
  ) +
  # Title and subtitles
  theme(
*   plot.title = element_text(hjust = 0.5),
*   axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

---

# Bar plots 

Now this looks better:

&lt;img src="4-data-visualization_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Bar plots 

## Exercise 1c: Improve your bar plot

But we can actually make this even better. I would reorder by amount of employees, and add labels. 


``` r
# Create the bar plot
ggplot(employees_by_department) +
  aes(x = reorder(department, -number), y = number) + #&lt;&lt;  # Reorder bars by `number`
  geom_col(fill = "#9370DB") +
*   geom_text(
*   aes(label = number),
*   angle = 90
* ) +
  labs(
    title = "Number of employees by department, 2024",
    x = "Department",
    y = "Number"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_text(angle = 45, hjust = 1) # Rotate x-axis labels
  )
```

---

# Bar plots

Now this is ready to be in one of your reports. 

&lt;img src="4-data-visualization_files/figure-html/unnamed-chunk-22-1.png" style="display: block; margin: auto;" /&gt;


---

# Bar plots 

## Exercise 1d: save your plot

Now that your plot looks good, you can save it into an output with `ggsave()`

1. Use this code to save your plot:


``` r
ggsave("employees_by_department.png",
       width = 20,
       height = 10,
       units = "cm")
```

---

# Bar plots  

.pull-left[
- `ggsave()` by default saves the last plot your produced

- The first argument in `ggsave()` is the name of the file we save the plot into. We can also use file paths here

- The rest are optional arguments that define the dimensions of the image you export, it's better to define them so the image has the correct proportions and text size
]

.pull-right[
&lt;img src="img/session4/ggsave-ex1.png" width="95%" style="display: block; margin: auto;" /&gt;
]

---

# You Did Your First Plot! 🎉  

## The Possibilities Are Endless  

- Congratulations on creating your **first plot**!  
- From here, you can explore countless options to visualize your data:  
  - Bar graphs, line plots, scatterplots, pie charts, and more.  
- Experimentation is key! Don’t be afraid to try new things or make mistakes.  

## You Have the Power 💪  

- Data visualization is a skill that grows with practice.  
- Use online resources and communities like:  
  - [ggplot2 Documentation](https://ggplot2.tidyverse.org/)  
  - [ggplot presentation](https://pkg.garrickadenbuie.com/gentle-ggplot2)

---

# Now the sky is the limit! 🎉  

.pull-center[
![](https://media.giphy.com/media/ely3apij36BJhoZ234/giphy.gif?cid=790b7611p87zw04yox77s108ey9w37ywgr19nck8aphgxiu6&amp;ep=v1_gifs_search&amp;rid=giphy.gif&amp;ct=g)  
]

---

class: inverse, center, middle
name: pie-charts

# Pie charts

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Pie charts

## From Bar Plots to Pie Charts  

- We just created a **bar plot** to visualize the number of employees by department.  
- Let’s now use the **same data** to create a **pie chart**, a common way to show proportions.  

### Geoms and Graph Types  
Remember: The **geom** controls the type of graph we create.  
- **`geom_col()`**: Creates bar plots.  
- **`geom_bar()`** with **coord_polar()**: Converts data into a pie chart.  

---

# Pie Charts  

## Exercise 2a: Create a Pie Chart  

1. Use the following code to create a pie chart:


``` r
ggplot(employees_by_department) +
  aes(x = "", y = number, fill = department) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(
    title = "Proportion of employees by department, 2024"
  ) +
  theme_void()
```
---

# Pie chart

You should see this on your Plots panel.

&lt;img src="4-data-visualization_files/figure-html/unnamed-chunk-26-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# Pie chart

## Exercise 2b

The chart is alright, but we can customize it further.. What about changing the colors? 



``` r
ggplot(employees_by_department) +
  aes(x = "", y = number, fill = department) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(
    title = "Proportion of employees by department, 2024"
  ) +
  theme_void() +
* scale_fill_viridis_d(option = "D")
```

---

# Pie chart

## Exercise 2c

Now this is ready to go into our report, so let's save it. 

&lt;img src="4-data-visualization_files/figure-html/unnamed-chunk-28-1.png" width="60%" style="display: block; margin: auto;" /&gt;


---

# Pie chart

## Exercise 2c

Now this is ready to go into our report, so let's save it. 


``` r
ggsave("employees_by_department_pie.png")
```

&lt;img src="img/session4/ggsave-ex2.png" width="40%" style="display: block; margin: auto;" /&gt;


---

class: inverse, center, middle
name: line-plots

# Line plots 

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Line plots 

Another Common Plot: Line Plots  

- **Line plots** are commonly used to show **trends over time** or changes across a sequence.  
- Examples include visualizing **monthly sales**, **yearly growth**, or **temperature changes**.  


**Description**  
- Each point represents a value at a specific time.  
- Lines connect the points to show a continuous trend.  



---

# Line plots 
.pull-left[
**Code Example**  


``` r
library(ggplot2)

# Using built-in `economics` dataset from ggplot2
ggplot(economics) +
  aes(x = date, y = unemploy) +
  geom_line(color = "#9370DB", size = 1) +
  labs(
    title = "Unemployment Over Time",
    x = "Date",
    y = "Number of Unemployed"
  ) +
  theme_minimal()
```
]

.pull-right[
**Output Example**  

&lt;img src="4-data-visualization_files/figure-html/unnamed-chunk-32-1.png" style="display: block; margin: auto;" /&gt;
]


---

class: inverse, center, middle
name: wrapping-up

# Wrapping up  

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Wrapping up  

## More in `ggplot2` 

This table lists several of the most popular encoding types in `ggplot2`. Also see more [here](https://ggplot2.tidyverse.org/reference/)

| Encoding | Function in `ggplot2` |
| -------- | --------------------- |
| Bars | `geom_col()` |
| Lines | `geom_line()` |
| Points (scatterplot) | `geom_point()` |
| Area | `geom_area()` |
| Histogram | `geom_histogram()` |
| Floating labels (texts) | `geom_text()` |
| Box plot | `geom_boxplot()` |
| Pie chart | `geom_bar() + coord_polar()` |
| Smoothed line | `geom_smooth()` |

---

# Wrapping up 

## Save your code!

Click on the floppy disk to save your code in a location that you will remember.

&lt;img src="img/session4/save.png" width="55%" style="display: block; margin: auto;" /&gt;

---

# Wrap-Up: Looking Ahead 🚀  

## Key Takeaways  

- Today, you learned how **data + code** can create powerful visualizations and tables for your annual reports.  
- **Why this matters:**  
   - Code is **reusable**: Use it for next quarters or years without starting from scratch.  
   - Code is **transparent**: Everyone can see and verify all the calculations.  

---

# Wrap-Up: Looking Ahead 🚀  

## From Data to Annual Reports  

.pull-center[
**Data + Code** → **Annual Report**  
![](img/data_code_report.png)  
*Reproducible workflows save time and improve accuracy.*  
]

## What’s Next?  

- **Tomorrow**: Bring your own data, graphs, or tables.  
   - We’ll have a **long hands-on session** where you can:  
     - Ask questions about how to code specific visualizations or tables.  
     - Work with your own data to make real progress.  

---

# Wrap-Up: Looking Ahead 🚀  

## Final Thoughts 💡  

- This is **new and challenging**, but it’s also incredibly **powerful** and **useful**.  
- The only way to get better is to **keep practicing**.  
- Experiment, google, ask questions, and remember—this will make your reports and your work clearer, faster, and less error-prone!  

Keep going—you’ve got this! 

![](https://media.giphy.com/media/VkjXj4cqRHsj8N29PX/giphy.gif?cid=790b7611byy41c83s55kw54q7b1errezjd68xiwimkovb7ki&amp;ep=v1_gifs_search&amp;rid=giphy.gif&amp;ct=g)


---

class: inverse, center, middle

# Thanks! // ¡Gracias! // 

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;
&lt;img src="img/session4/welcome-r.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# Resources for Data Visualization 📚  

## Learn More About ggplot2  

- **ggplot2 Documentation**  
  [ggplot2.tidyverse.org](https://ggplot2.tidyverse.org)  

- **R Graphics Cookbook** (Online resource for practical examples)  
  [r-graphics.org](https://r-graphics.org)  

- **R for Data Science**: Chapter on Data Visualization  
  [r4ds.had.co.nz](https://r4ds.had.co.nz/data-visualisation.html)  

- **ggplot2 Cheatsheet** (Quick reference for all functions)  
  [Download the cheatsheet here](https://github.com/rstudio/cheatsheets/raw/main/data-visualization-2.1.pdf)  
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
