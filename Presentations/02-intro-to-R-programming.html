<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Session 2: Introduction to R Programming</title>
    <meta charset="utf-8" />
    <meta name="author" content="DIME Analytics" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/xaringanExtra-webcam/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="libs/remark-css/default.css" type="text/css" />
    <link rel="stylesheet" href="libs/remark-css/metropolis.css" type="text/css" />
    <link rel="stylesheet" href="libs/remark-css/metropolis-fonts.css" type="text/css" />
    <link rel="stylesheet" href="libs/remark-css/custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Session 2: Introduction to R Programming
]
.subtitle[
## R for Stata Users
]
.author[
### DIME Analytics
]
.date[
### The World Bank | <a href="https://github.com/worldbank">WB Github</a> <br> March 2024
]

---




&lt;style type="text/css"&gt;
@media print {
  .has-continuation {
    display: block !important;
  }
}

&lt;/style&gt;



# Table of contents

1. [Introduction](#introduction)
1. [Initial settings](#initial-settings)
1. [File paths](#file-paths)
1. [Using Packages](#using-packages)
1. [Functions inception](#functions-inception)
1. [Mapping and iterations](#mapping-and-iterations)
1. [Custom functions](#custom-functions)
1. [Appendix](#appendix)

---

class: inverse, center, middle
name: introduction

# Introduction

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# What this session is about

* In the first session, you learned how to work with R

* You are probably eager to start programming in R by now

* But before you start, we recommend learning how to write R code that will be __reproducible, efficient, intelligible and easy to navigate__

* Indeed, that's what this session is about!

---

# What this session is about

* We will cover common coding practices in R so that you can make __the most efficient use__ for it

* We will also discuss some styling conventions to make your code __readable and reproducible__

* This will give you a solid foundation to write code in R and hopefully you'll be able to skip some painful steps of the "getting-your-hands-dirty" learning approach

---

class: inverse, center, middle
name: initial-settings

# Initial settings

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Initial settings

* Let's start by opening RStudio or by closing and opening it again

* Notice two things:

  1. Your environment is *probably* empty (it's OK if it's not)

&lt;img src="img/empty_environment.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# Initial settings

* Let's start by opening RStudio or by closing and opening it again

* Notice two things:

  1. Your environment is *probably* empty (it's OK if it's not)
  1. Go to the `Console` panel and use the up and down keys to navigate through previously executed commands. They are saved by default in a file named `.Rhistory` that you might have noticed

&lt;img src="img/rhistory.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Initial settings

* Let's start by opening RStudio or by closing and opening it again

* Notice two things:

  1. Your environment is *probably* empty (it's OK if it's not)
  1. Go to the `Console` panel and use the up and down keys to navigate through previously executed commands. They are saved by default in a file named `.Rhistory` that you might have noticed
  
* We usually want these two things —an __empty environment__ and the __history of commands__ executed in previous sessions— to be present every time we open a new RStudio session

---

# Initial settings

Have you ever seen these lines of code before?

&lt;img src="img/stataheader.jpg" width="40%" style="display: block; margin: auto;" /&gt;

---

# Initial settings

Have you ever seen these lines of code before?

&lt;img src="img/stataheader.jpg" width="40%" style="display: block; margin: auto;" /&gt;

* We __don't need to set the memory or the maximum number of variables__ in R

* The equivalent of `set more off` is the default

* The equivalent of `clear` is not always default setting, but we'll make sure it is set in exercise 1

---

# Initial settings

.exercise[

### Exercise 1 <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg> &lt;font size="5"&gt;(<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg> 1 min)&lt;/font&gt;

After this, you'll never have to use  the equivalent of `clear all`

1. Go to `Tools` &gt; `Global Options...`

2. In the `General` tab, make sure the following options are set:

  + Un-check *Restore .RData into workspace at startup*
  + For *Save workspace to .RData on exit*, select *Never*
  + Make sure *Always save history (even when not saving .RData)* is checked
  
3. Now restart RStudio
]

---

# Initial settings

&lt;img src="img/options1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

# Initial settings

&lt;img src="img/options2.png" width="60%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
name: file-paths

# File paths

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# File paths

* What about working directories? We usually do something like this every time we start a new script in Stata:

&lt;img src="img/stata_cd.png" width="35%" style="display: block; margin: auto;" /&gt;

* The direct equivalent to `cd` in R is this command:


```r
setwd("your/path")
```

* However, we recommend not using it unless it's absolutely necessary (never, if possible)

---

# RStudio projects

* Instead, you should use RStudio projects and the `here` library

* RStudio projects let you "bind" your project files to a root directory, regardless of the path to it

* This is crucial because it allows smooth interoperability between different computers where the exact path to the project root directory differs

* Additionally, each RStudio project you work on keeps their own history of commands!

__Important:__ We won't get into the specifics of directory organization here, but we'll assume that all the files you use for a specific project (data, scripts, and outputs) reside in the same project directory. We'll call this the __working directory__.

---

# RStudio projects

.exercise[

### Exercise 2 <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg> &lt;font size="5"&gt;(<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg> 3 min)&lt;/font&gt;

1. Create a folder named `dime-r-training-202403` in your preferred location in your computer

1. Go to https://osf.io/86g3b/ and download the file in: `R for Stata Users - 2024 March` &gt; `Data` &gt; `DataWork.zip`

1. Unzip `DataWork.zip` in your folder `dime-r-training-202403`

1. On RStudio, select `File` &gt; `New Project...`

1. Select `Existing Directory`

1. Browse to the location of `dime-r-training-202403` and select `Create Project`
]

---

# RStudio projects

&lt;img src="img/dime-r-training-project.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# RStudio projects

&lt;img src="img/dime-r-training-project-dir.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# The `here` library

* `here` locates files relative to your project root

* It uses the root project directory to build paths to files easily

* It allows for interoperability between different computers where the absolute path to the same file is not the same

---

# Usage of `here`

- Load `here`


```r
install.packages("here") # install first if you don't have it
library(here)
```

- Now you'll be able to use `here()` to point the location of every file relative to your project root

  + For example, to load a `csv` file located in: `C:/WBG/project-root/data/raw/data-file.csv`, you should use:
  

```r
path &lt;- here("data", "raw", "data-file.csv")
df   &lt;- read.csv(path)
```

* __Notes:__

  + Your project root is the directory that contains the `.Rproj` file
  + The result of `here()` is an absolute path that points to a file or folder location in your computer

---

# File paths

.exercise[

### Exercise 3 <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg> &lt;font size="5"&gt;(<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg> 3 min)&lt;/font&gt;

1. Go to `File` &gt; `New File` &gt; `R Script` to open a new script

1. In the new script, load `here` and read the `.csv` file in `DataWork/DataSets/Final/whr_panel.csv` using `here()`

  + Use the function `read.csv()` to load the file. The argument for `read.csv()` is the result of `here()`
  + Remember to assign the dataframe you're reading to an object. You can call it `whr` as we did yesterday

]


```r
library(here)
whr &lt;- read.csv(here("DataWork", "DataSets", "Final", "whr_panel.csv"))
```

---

# RStudio projects and `here`

If you did the exercise correctly, you should see the `whr` dataframe listed in the Environment panel

&lt;img src="img/environment_2021.png" width="80%" style="display: block; margin: auto;" /&gt;

---

class: inverse, center, middle
name: using-packages

# Using packages

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Packages

- Installing R in your computer gives you access to its basic functions

- Additionally, you can also install packages. Packages are code with additional R functions that allow you to do:

  + Operations that basic R functions don't do (example: work with geographic data)
  
  + Operations that basic R functions do, but easier (example: data wrangling)

---

# Packages

In a nutshell:

&lt;img src="img/r-libraries.png" width="99%" style="display: block; margin: auto;" /&gt;

---

# Packages

* You can install packages with the command `install.packages()`. packages are also commonly called "libraries" in R programming


```r
# Installing a package
install.packages("dplyr")
```

* You only have to install a package once, but you have to __load them every new session__ with `library()`


```r
# Installing a package
library(dplyr)
```

---

# Packages

- Package installation:

&lt;img src="img/installation.png" width="37%" style="display: block; margin: auto;" /&gt;

- Package loading:

&lt;img src="img/loading.png" width="37%" style="display: block; margin: auto;" /&gt;

---

# Using packages

.exercise[

### Exercise 4 <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg> &lt;font size="5"&gt;(<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg> 1 min)&lt;/font&gt;

1. Load the packages `dplyr` and `purrr` using `library(dplyr)` and `library(purrr)`

]

__Note:__ There is no need to install `dplyr` and `purrr` as they are part of the meta-library `tidyverse`, which we asked to install before this course. If you didn't have the chance to install `tidyverse`, then install `dplyr` and `purrr` with:


```r
install.packages("dplyr")
install.packages("purrr")
```

---

# Warnings vs errors

What if this happens?

&lt;img src="img/Warning.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Warnings vs errors

R has two types of error messages, warnings and actual errors:

  * **Errors** - break your code, usually preventing it from running
  * **Warnings** - your code kept running, but R wants you to be aware of something that might be a problem later

RStudio prints warning messages but it doesn't stop the code excution if warnings occur.

---

class: inverse, center, middle
name: functions-inception

# Functions inception

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# A function inside a function

* In R, you can __write one function inside another__

* Here's an example:

---

# A function inside a function


```r
# Print the summary of the logarithm of the happiness score

## The long way:
log_score &lt;- log(whr$happiness_score)
summary(log_score)

# The shortcut
summary(log(whr$happiness_score))
```

&lt;iframe src="https://rrmaximiliano.shinyapps.io/learnr-app/?showcase=0" width="100%" height="400px" data-external="1"&gt;&lt;/iframe&gt;

---

# A function inside a function

* This is a simple example of __metaprogramming__ (that's the real name of this technique) and may seem trivial, but it's not

* For starters, you can't do it in Stata!

---

# A function inside a function

&lt;img src="img/statalog.png" width="50%" style="display: block; margin: auto;" /&gt;

---

# A function inside a function

* Metaprogramming is a __very powerful technique__, as you will soon see

* It's __also a common source of error__, as you can only use one function inside the other if the output of the inner function can be taken as the input of the outer function

* It can also get quite tricky to follow what a line of code with multiple functions inceptions is doing

---

# Piping

* Ever heard of piping? It's this: `%&gt;%`

* Piping is a way of doing metaprogramming

* The actual meaning of the pipes is: *Pipes take the __output__ of the function at the left and pass it as the __first argument__ of the function at the right*

* The advantages of using piping is that it allows to have a cleaner division of successively applied functions in R code, __drastically improving code readability__

---

# Piping


```r
  # 1: Doing it the long way -----------------------------
  log_score &lt;- log(whr$happiness_score)
  mean(log_score)

  # 2: Shortcut to get to the same place -----------------
  mean(log(whr$happiness_score))

  # 3: Now with pipes ------------------------------------
  whr$happiness_score %&gt;% log() %&gt;% mean()
```

In other words:

* `x %&gt;% f()` is the same as `f(x)`

* `x %&gt;% f() %&gt;% g()` is the same as `g(f(x))`

---

# Piping

## Always use pipes!

Now that you now about the power of the pipes, use them wisely!

.pull-left[
- Remember that pipes are part of the library `dplyr`, you need to load it before using them

- Pipes also avoid the hassle of having to save intermediate results in new objects in the environment, improving efficiency

- Many R coders use pipes and internet examples assume you know them

- **We'll use pipes now in the next examples and exercises of the rest of this training**
]

.pull-right[
&lt;img src="img/pipes-joke.png" width="45%" style="display: block; margin: auto;" /&gt;
]

---

class: inverse, center, middle
name: mapping-and-iterations

# Mapping and iterations

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Iterations in R

* In Stata, we use `for` loops very frequently

* In R, the syntax of `for` loops is this:


```r
    for (number in 1:3) {
        print(number)
    }
```

```
## [1] 1
## [1] 2
## [1] 3
```

---

# Map

* R, however, has a set of functions that allows users to loop through an object __in a more efficient way__, without using explicit loops

* In this training we'll introduce `map()`. It is a function part of `purrr`,  a package that contains tools for functional programming

* Also, in case you have not noticed yet: __R is vectorized!__ this means that many operations are applied element-wise by default so you don't have to code loops to apply them to each element of a vector or dataframe

---

# Map

* To use `map()`, you need to load the package `purrr`

* The basic syntax of `map()` is:

.command[

**`map(X, function, ...)`:** applies `function` to each of the elements of `X`. If `X` is a dataframe then `function` is applied column-wise while if it's a vector or a list it is applied item-wise. The output of `map()` is always a list with the results.

  + **X:** a dataframe, matrix or vector the function will be applied to
  + **function:** the name of the function you want to apply to each of the elements of `X`
]


---

# Map


```r
# Round the values of the following vector
x &lt;- c(1.2, 2.5, 9.1, 5.8)
x %&gt;% map(round) # Rounding the vector elements (same as map(x, round))
round(x)         # since R is vectorized, this also works
```

&lt;iframe src="https://rrmaximiliano.shinyapps.io/learnr-app/?showcase=0" width="100%" height="400px" data-external="1"&gt;&lt;/iframe&gt;

---

# Map vs looping

* When looping, you repeat the same operation over a set of items

* `map()`, instead, takes all your elements at once and applies an operation to them simultaneously

* The difference is like this:

  + Imagine you ask a yes/no question to a group of people
  + You can collect the answers by asking each one of them individually -- __this is looping__
  + Otherwise, you can ask them to raise their hands and collect all answers at once -- __this is `map()`__

---

# Map vs looping

* The output of a loop is the regular output of the operation you're repeating, times the number of iterations you did

* The output of `map()` will be always a list

* When it comes to code clarity, `map()` has a few advantages:

 + Loops often have side effect results, like a temporary variable that stays in the environment after the loop finishes
 + `map()` often involves less lines of code than loops

---

# Map vs looping

.exercise[

### Exercise 5: Looping over a dataframe &lt;font size="5"&gt;(<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg> 3 min)&lt;/font&gt;

- Create a toy dataframe of 50,000 columns and 400 observations using this code


```r
df &lt;- data.frame(replicate(50000, sample(1:100, 400, replace=TRUE)))
```

- Create an empty vector named `col_means_loop` where you will store column means with this code: `col_means_loop &lt;- c()`
- Loop over every column to get the column means and store them in the vector


```r
for (column in df) {
  ....
}
```

- Inside the loop:

  + Use `mean()` to get each column mean
  + Use `append()` to add a new mean to the vector: `col_means_loop &lt;- append(col_means_loop, new_mean)`

]

---

# Map vs looping

The solution is this:


```r
df &lt;- data.frame(replicate(50000, sample(1:100, 400, replace=TRUE)))

col_means_loop &lt;- c()

for (column in df){
  
  new_mean &lt;- mean(column)
  
  col_means_loop &lt;- append(col_means_loop, new_mean)
  
}
```

---

# Map vs looping

.exercise[

### Exercise 6: Now use `map()` <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg> &lt;font size="5"&gt;(<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg> 1 min)&lt;/font&gt;

1. Use `map()` to produce a list with the means of the columns of `df`
1. Store the result in a list named `col_means_map`

]

Hints:
  + Remember the syntax of `map()`: `map(X, function_name)`
  + The function name inside `map()` shouldn't have parentheses next to it (i.e.: `mean` instead of `mean()`)

---

# Map vs looping

Compare the syntax of the solutions of both exercises:


```r
# Dataframe creation
df &lt;- data.frame(replicate(50000, sample(1:100, 400, replace=TRUE)))

# Loop exercise
col_means_loop &lt;- c()

for (col in df){
  col_means_loop &lt;- append(col_means_loop, mean(col))
}

# Map exercise
col_means_map &lt;- map(df, mean)
```

Do you remember which one ran faster?

---

# Map vs looping

Also, remember we said that loops produce side effects?

&lt;img src="img/loop-side-effects.png" width="50%" style="display: block; margin: auto;" /&gt;

---

# Map vs looping

* `map()` looks nice, doesn't it?

* But what about cases when it's impossible to implement the operations I want to apply in only one function? Do I have to use `for` loops then?

* Not at all! Let's get to the next section for those cases.

---

class: inverse, center, middle
name: custom-functions

# Custom functions

&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#D38C28' size=1px width=1100px&gt;&lt;/html&gt;

---

# Writing your own functions

* As we have said several times, __R is super flexible__

* One example of that is that it's __super easy and quick to create custom functions__

* Here's how:

---

# Custom functions


```r
  square &lt;- function(x) {
    y &lt;- x ^ 2
    return(y)
  }
```

&lt;iframe src="https://rrmaximiliano.shinyapps.io/learnr-app/?showcase=0" width="100%" height="400px" data-external="1"&gt;&lt;/iframe&gt;

---

# Custom functions

.exercise[

### Exercise 7 <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg> &lt;font size="5"&gt;(<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg> 2 min)&lt;/font&gt;

Create a function named `zscore` that standardizes the values of a vector.

&gt; **Hints:**
* The command to obtain the mean of a vector is `mean(x)`
* The command to get the SD of a vector is `sd(x)`
* R is vectorized: you can operate vectors and numbers directly and the result will be a vector
* Don't forget to include the argument `na.rm = TRUE` in `mean()` and `sd()`
* Recall the syntax of custom functions in R:


```r
function_name &lt;- function(input) {
  
  output &lt;- operation(input)
  
  return(output)

}
```

]



---

# Custom functions


```r
zscore &lt;- function(x) {
    mean &lt;- mean(x, na.rm = TRUE)
    sd   &lt;- sd(x, na.rm = TRUE)
    z    &lt;- (x - mean)/sd
    return(z)
  }
```

&lt;iframe src="https://rrmaximiliano.shinyapps.io/learnr-app/?showcase=0" width="100%" height="400px" data-external="1"&gt;&lt;/iframe&gt;

---

# Custom functions

.exercise[

### Exercise 8 <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg>

1. Subselect the columns `health_life_expectancy` and `freedom` in `whr`

  + Use dplyr's `select()` for this, as in: `whr %&gt;% select(freedom, happiness_score)` 

2. Use `map()` combined with the `zscore` function to get the z-score of these two columns and assign the resulting list to an object named `z_scores`

3. Use list indexing on `z_scores` to generate two new columns in `whr` with the standardized values of `health_life_expectancy` and `freedom`
  
 **Hints:**
* Don't use parenthesis next to the function name we're using `map()` with
* Use double brackets instead of single brackets or the symbol `$` to index the elements of a list

]

---

# Custom functions


```r
z_scores &lt;- whr %&gt;%
  select(health_life_expectancy, freedom) %&gt;%
  map(zscore)
whr$hle_st &lt;- z_scores[[1]]
whr$freedom_st &lt;- z_scores[[2]]
```

&lt;iframe src="https://rrmaximiliano.shinyapps.io/learnr-app/?showcase=0" width="100%" height="400px" data-external="1"&gt;&lt;/iframe&gt;

---

class: inverse, center, middle

# Thank you!

---

class: inverse, center, middle
name: appendix

# Appendix

---

# Appendix - `.Rhistory` and `.RData`

* `.Rhistory` automatically stores the commands entered in the console

* `.RData` stores the objects in your environment only if you save your workspace, and loads them again in the next RStudio session

* Both files are stored in the working directory where your RStudio session started

---

# Appendix - More on packages

Once a package is loaded, you can use its features and functions. Here's a list of some useful packages:

* `Rcmdr` - easy to use GUI
* `swirl` - an interactive learning environment for R and statistics.
* `ggplot2` - beautiful and versatile graphics (the syntax is a pain, though)
* `stargazer` - awesome latex regression and summary statistics tables
* `foreign` - reads `.dta` and other formats from inferior statistical software
* `zoo` - time series and panel data manipulation useful functions
* `data.table` - some functions to deal with huge dataframes
* `sp` and `rgeos` - spatial analysis
* `multiwayvcov` and `sandwich` - clustered and robust standard errors
* `RODBC`, `RMySQL`, `RPostgresSQL`, `RSQLite` - For relational databases and using SQL in R.

---

# Appendix - Git

Git is a version-control system for tracking changes in code and other text files. It is a great resource to include in your work flow.

We didn't cover it here because of time constraints, but below are some useful links, and DIME Analytics provides trainings on Git and GitHub, so keep an eye out for them.

* **DIME Analytics git page:** https://worldbank.github.io/dimeanalytics/git/

* **A Quick Introduction to Version Control with Git and GitHub:** https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1004668

---

# Appendix - More on R projects

If you want to learn more about them, we recommend starting here:
https://r4ds.had.co.nz/workflow-projects.html

---

# Appendix - More on folder management

* A discussion of folder structure and data managament can be found here: https://dimewiki.worldbank.org/wiki/DataWork_Folder

* For a broader discussion of data management, go to https://dimewiki.worldbank.org/wiki/Data_Management

---

# Appendix - Column extraction operators

* Remember the use of `$` to extract columns from a dataframe?

* Other than `$`, we can also use double brackets to extract the column of a dataframe:


```r
# With $:
whr$year
```


```r
# With [[]]:
whr[["year"]] # Notice the use of double quotes
```

---

# Appendix - Column extraction operators: `[[]]` vs `$`

What's the key difference between them?

Well, `[[]]` lets us use other objects to refer to column names, while `$` doesn't


```r
col_name &lt;- "year"
head(whr$col_name) # this returns a NULL object because no column has the name "col_name" in whr
```

```
## Warning: Unknown or uninitialised column: `col_name`.
```

```
## NULL
```


```r
col_name &lt;- "year"
head(whr[[col_name]])
```

```
## [1] 2015 2015 2015 2015 2015 2015
```

---

# Appendix - Column extraction operators: `[[]]` vs `$`

This difference is key because we can use `[[]]` to loop through column names, while this is not directly possible with `$`.


```r
# Printing the first observation of every column of whr
for (col in colnames(whr)) {
  whr[[col]] %&gt;%
    head(1) %&gt;%
    print()
}
```

```
## [1] "Switzerland"
## [1] "Western Europe"
## [1] 2015
## [1] 1
## [1] 7.587
## [1] 1.39651
## [1] 0.94143
## [1] 0.66557
```

---

# Appendix - Apply

* Apart from purrr's `map()`, base R also has a set of functions that allows users to apply a function to a number of objects without using explicit loops

* They're called `apply` and there are many of them, with different use cases

* If you look for the `apply` help file, you can see all of them

* We'll show only two of them, `sapply` and `apply`

---

# Appendix - Apply

* The syntax of `sapply()` is:


```r
sapply(X, FUN, ...)
```

* Its main arguments are:

  + **X:** a dataframe, matrix or vector the function will be applied to
  + **FUN:** the function you want to apply

* `sapply()` applies the function (`FUN`) to all the elements of `X`. If `X` is a dataframe then the function is applied column-wise, while if it's a vector or a list it is applied item-wise

* The output of `sapply()` is usually a vector with the results, but it can be a matrix if the results have more than one dimension

---

# Appendix - Apply


```r
    # A for loop in R
    for (number in c(1.2, 2.5)) {
      print(round(number))
    }

    # A much more elegant option
    sapply(c(1.2, 2.5), round)
```

---

# Appendix - Apply


```r
# Printing the first observation of every column of whr
for (col in names(whr)) {
  print(head(whr[[col]], 1))
} # Option 1

sapply(whr, head, 1) # A more elegant and efficient option
```

---

# Appendix - Apply

* A more general version of `sapply()` is the `apply()` function. This is its syntax:


```r
apply(X, MARGIN, FUN, ...)
```

* Arguments:

  + **X:** a dataframe (or matrix) the function will be applied to
  + **MARGIN:** 1 to apply the function to all rows or 2 to apply the function to all columns
  + **FUN:** the function you want to apply

* `apply()` applies a function (`FUN`) to all columns or rows of matrix (`X`). A value of 1 in `MARGIN` indicates that the funcion should be applied row-wise, while 2 indicates columns

---

# Appendix - Apply


```r
matrix &lt;- matrix(c(1, 24, 9, 6, 9, 4, 2, 74, 2), nrow = 3) # Defining a matrix
apply(matrix, 1, mean) # row means
apply(matrix, 2, mean) # column means
```

---

# Appendix - Assignment 1

### Exercise: Get the row max

1. Select the columns `freedom` and `happiness_score` of `whr`

2. Use `apply()` to get the row max between these two columns, for every row

* Hints:
  + Remember the syntax of `apply()`: `apply(X, MARGIN, FUN)`
  + A value of 1 for `MARGIN` indicates that the function must applied row-wise
  + The function to get the maximum over a set of number is `max`

---

# Appendix - Apply

Solution: 


```r
whr %&gt;%
  select(freedom, happiness_score) %&gt;%
  apply(1, max)
```

---

# Appendix - Commenting

* To comment a line, write `#` as its first character


```r
# This is a comment
print("But this part is not")
```

* You can also add `#` halfway through a line to comment whatever comes after it


```r
print("This part is not a comment") # And this is a comment
```

* In Stata, you can use `/*` and `*/` to comment in the middle of a line's code. That is not possible in R: everything that comes after `#` will always be a comment

* To comment a selection of lines, press `Ctrl` + `Shift` + `C`

---

# Appendix - Assignment 2

.exercise[

### Exercise <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg>

1. In your script panel, select all the lines of your script

2. Use the keyboard shortcut to comment these lines.
  + Shortcut: `Ctrl` + `Shift` + `C`

3. Use the keyboard shortcut to comment these lines again. What happened?

]

---

# Appendix - Document outline

* RStudio allows you to __create an interactive index__ for your scripts

* To add a section to your code, create a commented line with the title of your section and add at least 4 trailing dashes (`----`), pound signs (`####`) or equal signs (`====`) after it

---

# Appendix - Document outline

* The outline can be accessed by clicking on the button on the top right corner of the script window. You can use it to jump from one section to another

* You can also use the keyboard shortcuts `Alt + L` (`Cmd + Option + L` on Mac) and `Alt + Shift + L` to collapse and expand sections

&lt;img src="img/document-outline.png" width="65%" style="display: block; margin: auto;" /&gt;

---

# Appendix - Indentation


```r
# Here's some code
annualHappy_reg &lt;- aggregate(happy_score ~ year + region, data = whr, FUN = mean)
ggplot(annualHappy_reg,aes(y = happy_score,x = as.factor(year), color = region, group = region)) +
geom_line() + geom_point()
```


```r
# Here's the same code
annualHappy_reg &lt;-
  aggregate(happiness_score ~ year + region,
            data = whr,
            FUN = mean)

ggplot(annualHappy_reg,
       aes(y = happiness_score,
           x = as.factor(year),
           color = region,
           group = region)) +
geom_line() +
geom_point()
```

---

# Appendix - Indentation

&lt;img src="02-intro-to-R-programming_files/figure-html/unnamed-chunk-60-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

# Appendix - Indentation

* R understands what unindented code says, but it can be __quite difficult for a human being to read it__

* On the other hand, __white space does not have a special meaning for R__, so it will understand code that is more readable for a human being

---

# Appendix - Indentation

* Indentation in R looks different than in Stata:

 - To indent a whole line, you can select that line and press `Tab`
 - To unindent a whole line, you can select that line and press `Shift + Tab`
 - However, this will not always work for different parts of a code in the same line

* In R, we typically don't introduce white space manually

* It's rather introduced by RStudio for us

---

# Appendix - Assignment 3

.exercise[

### Exercise <svg aria-hidden="true" role="img" viewBox="0 0 576 512" style="height:1em;width:1.12em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 112c-8.8 0-16 7.2-16 16V384c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V128c0-8.8-7.2-16-16-16H64zM0 128C0 92.7 28.7 64 64 64H512c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128zM176 320H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V336c0-8.8 7.2-16 16-16zm-72-72c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16zm64 96c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V248zm16-96h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V168c0-8.8 7.2-16 16-16z"/></svg>

To see an example of how indenting works in RStudio, let's use an example with `map()`:


```r
# An elegant "loop" in R
map(c(1.2, 2.5, 9.1, 5.8), round)
```

1. Add a line between the two arguments of the function (the vector of numbers and `round`)

2. Now add a line between the numbers in the vector.
]

---

# Appendix - Indentation

Note that RStudio formats the different arguments of the function differently:


```r
# A much more elegant loop in R
map(c(1.2,
      2.5,
      9.1,
      5.8),
    round)
```

---

# Appendix - Exploring a dataframe

Some useful functions:

* **`View()`:** opens a visualization of the dataframe

* **`class()`:** reports object type or type of data stored

* **`dim()`:** reports the size of each one of an object's dimension

* **`names()`:** returns the variable names of a dataframe

* **`str()`:** general information about the structure of an R object

* **`summary()`:** summary information about the variables in a dataframe

* **`head()`:** shows the first few observations in the dataframe

* **`tail()`:** shows the last few observations in the dataframe

---
exclude: true


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
